quartz(width=3.5,height=2)
pdf("./figures/scopusfig_model_1.pdf",width=3.5,height=2.5)
pf1
dev.off()
se<-function(x) sd(x,na.rm=T)/sqrt(length(x))
mean.dat<-ddply(dat,.(Year,bin,OA),summarize,
MeanCite = mean(Cited.by,na.rm=T),
SECite = se(Cited.by))
mean.dat<-ddply(mean.dat,.(bin,OA),summarize,
MeanCite = mean(MeanCite,na.rm=T),
SECite = se(SECite))
mean.dat$xdummy<-as.numeric(as.factor(mean.dat$bin)) + with(mean.dat,ifelse(OA==T,-0.15,0.15))
mean.dat$OA<-factor(mean.dat$OA,levels = c(TRUE,FALSE))
p1<-ggplot(mean.dat)
p1f<-p1 + theme_classic() +
theme(axis.title.x = element_blank()) +
ylab("Citations") +
theme(legend.title =  element_blank()) +
geom_pointrange(aes(x=xdummy,y=MeanCite,ymin=MeanCite-(SECite*1.96),ymax=MeanCite+(SECite*1.96),
colour=bin,shape=OA)) +
scale_x_continuous(breaks = seq(1:4),labels=c("Low","Medium","High","Very high"),
expand=c(0,0)) +
coord_cartesian(xlim=c(0.5,4.5)) +
scale_shape_manual(values = c(1,19),labels=c("Open","Closed")) +
scale_colour_discrete(guide=F)
p1f
mean.dat<-ddply(dat,.(Year,bin,OA),summarize,
MeanCite = mean(Cited.by,na.rm=T),
SECite = se(Cited.by))
mean.dat<-ddply(mean.dat,.(bin,OA),summarize,
MeanCite = mean(MeanCite,na.rm=T),
SECite = se(SECite))
mean.dat
mean.dat<-ddply(dat,.(bin,OA),summarize,
MeanCite = mean(Cited.by,na.rm=T),
SECite = se(Cited.by))
mean.dat$xdummy<-as.numeric(as.factor(mean.dat$bin)) + with(mean.dat,ifelse(OA==T,-0.15,0.15))
mean.dat$OA<-factor(mean.dat$OA,levels = c(TRUE,FALSE))
p1<-ggplot(mean.dat)
p1f<-p1 + theme_classic() +
theme(axis.title.x = element_blank()) +
ylab("Citations") +
theme(legend.title =  element_blank()) +
geom_pointrange(aes(x=xdummy,y=MeanCite,ymin=MeanCite-(SECite*1.96),ymax=MeanCite+(SECite*1.96),
colour=bin,shape=OA)) +
scale_x_continuous(breaks = seq(1:4),labels=c("Low","Medium","High","Very high"),
expand=c(0,0)) +
coord_cartesian(xlim=c(0.5,4.5)) +
scale_shape_manual(values = c(1,19),labels=c("Open","Closed")) +
scale_colour_discrete(guide=F)
p1f
?glmer
fit2a<-glmer(Cited.by ~ Open.Access*bin + (1|Year) + (1|Source.title),family = poisson)
fit2a<-glmer(Cited.by ~ Open.Access*bin + (1|Year) + (1|Source.title),data=dat,family = poisson)
summary(fit2a)
predict(fit2a)
plot(predict(fit2a)~dat$bin)
plot(predict(fit2a)~dat$bin)
y<-predict(fit2a)
plot(y~dat$bin)
g1+geom_boxplot(y~bin)
g1<-ggplot(dat)
g1+geom_boxplot(y~bin)
g1+geom_boxplot(aes(x=bin,y=y))
g1<-ggplot(dat)
g1+geom_boxplot(aes(x=bin,y=y,colour=OA))
fit1a<-lmer(Cited.by ~ Open.Access*bin + (1|Year) + (1|Source.title))
fit1a<-lmer(Cited.by ~ Open.Access*bin + (1|Year) + (1|Source.title),data=dat)
mod.fit<-fit1a  ## choose model to plot
y<-predict(fit1a)
g1<-ggplot(dat)
g1+geom_boxplot(aes(x=bin,y=y,colour=OA))
tdat<-dat[which(dat$Cited.by>0),]
dat<-dat[which(dat$Cited.by>0),]
se<-function(x) sd(x,na.rm=T)/sqrt(length(x))
names(dat)
sum.dat<-ddply(dat,.(Year,bin,OA),summarize,
NoArt = length(OA))
p1<-ggplot(sum.dat)
p1 + geom_line(aes(x=Year,y=NoArt,colour=bin,linetype=OA))
names(dat)
mean.dat<-ddply(dat,.(bin,OA),summarize,
MeanCite = mean(Cited.by,na.rm=T),
SECite = se(Cited.by))
mean.dat$xdummy<-as.numeric(as.factor(mean.dat$bin)) + with(mean.dat,ifelse(OA==T,-0.15,0.15))
mean.dat$OA<-factor(mean.dat$OA,levels = c(TRUE,FALSE))
p1<-ggplot(mean.dat)
p1f<-p1 + theme_classic() +
theme(axis.title.x = element_blank()) +
ylab("Citations") +
theme(legend.title =  element_blank()) +
geom_pointrange(aes(x=xdummy,y=MeanCite,ymin=MeanCite-(SECite*1.96),ymax=MeanCite+(SECite*1.96),
colour=bin,shape=OA)) +
scale_x_continuous(breaks = seq(1:4),labels=c("Low","Medium","High","Very high"),
expand=c(0,0)) +
coord_cartesian(xlim=c(0.5,4.5)) +
scale_shape_manual(values = c(1,19),labels=c("Open","Closed")) +
scale_colour_discrete(guide=F)
p1f
mean.dat<-ddply(dat,.(Year,bin,OA),summarize,
MeanCite = mean(Cited.by,na.rm=T),
SECite = se(Cited.by))
mean.dat<-ddply(mean.dat,.(bin,OA),summarize,
MeanCite = mean(MeanCite,na.rm=T),
SECite = se(SECite))
mean.dat$xdummy<-as.numeric(as.factor(mean.dat$bin)) + with(mean.dat,ifelse(OA==T,-0.15,0.15))
mean.dat$OA<-factor(mean.dat$OA,levels = c(TRUE,FALSE))
p1<-ggplot(mean.dat)
p1f<-p1 + theme_classic() +
theme(axis.title.x = element_blank()) +
ylab("Citations") +
theme(legend.title =  element_blank()) +
geom_pointrange(aes(x=xdummy,y=MeanCite,ymin=MeanCite-(SECite*1.96),ymax=MeanCite+(SECite*1.96),
colour=bin,shape=OA)) +
scale_x_continuous(breaks = seq(1:4),labels=c("Low","Medium","High","Very high"),
expand=c(0,0)) +
coord_cartesian(xlim=c(0.5,4.5)) +
scale_shape_manual(values = c(1,19),labels=c("Open","Closed")) +
scale_colour_discrete(guide=F)
p1f
names(dat)
mean.dat<-ddply(dat,.(Year,bin,OA),summarize,
MeanCite = mean(Cited.by,na.rm=T),
SECite = se(Cited.by))
mean.dat$binlabel<-with(mean.dat,ifelse(bin=="A","Low",
ifelse(bin=="B","Medium",
ifelse(bin=="C","High","Very high"))))
mean.dat$binlabel<-factor(mean.dat$binlabel,levels = c("Low","Medium","High","Very high"))
mean.dat$xdummy<-mean.dat$Year + with(mean.dat,ifelse(OA==T,-0.15,0.15))
mean.dat$OA<-factor(mean.dat$OA,levels = c(TRUE,FALSE))
p2<-ggplot(mean.dat)
p2 + geom_pointrange(aes(x=Year,y=MeanCite,ymin=MeanCite-(SECite*1.96),ymax=MeanCite+(SECite*1.96),
colour=bin,shape=OA))
p2 + geom_pointrange(aes(x=xdummy,y=MeanCite,ymin=MeanCite-(SECite*1.96),ymax=MeanCite+(SECite*1.96),
colour=bin,shape=OA)) +
scale_shape_manual(values = c(1,19),labels=c("Open","Closed"))
p2 + geom_pointrange(aes(x=xdummy,y=MeanCite,ymin=MeanCite-(SECite*1.96),ymax=MeanCite+(SECite*1.96),
colour=bin,shape=OA)) +
scale_shape_manual(values = c(1,19),labels=c("Open","Closed")) +
facet_wrap(~bin,scales = "free")
fit1a<-lmer(Cited.by ~ Open.Access*bin + (1|Year) + (1|Source.title),data=dat)
mod.fit<-fit1a  ## choose model to plot
summary(mod.fit)
coef1<-summary(mod.fit)$coefficients
out.fit1<-data.frame(Open.Access = rep(c("Closed","Open"),each=4),
jour.bin = rep(c(LETTERS[1:4]),times=2))
out.fit1$estimate<-c(coef1[1,1],
coef1[1,1] + coef1[3,1],
coef1[1,1] + coef1[4,1],
coef1[1,1] + coef1[5,1],
coef1[1,1] + coef1[2,1],
coef1[1,1] + coef1[2,1] + coef1[3,1] + coef1[6,1],
coef1[1,1] + coef1[2,1] + coef1[4,1] + coef1[7,1],
coef1[1,1] + coef1[2,1] + coef1[5,1] + coef1[8,1])
out.fit1$error<-c(coef1[1,2],
coef1[3,2],
coef1[4,2],
coef1[5,2],
coef1[2,2],
coef1[6,2],
coef1[7,2],
coef1[8,2])
out.fit1
out.fit1$xdummy<-as.numeric(as.factor(out.fit1$jour.bin)) +
with(out.fit1,ifelse(Open.Access=="Open",-0.15,0.15))
out.fit1$Open.Access<-factor(out.fit1$Open.Access,levels = c("Open","Closed"))
pfit1<-ggplot(out.fit1)
pf1<-pfit1 + theme_classic() +
theme(legend.title =  element_blank(),
axis.title.x = element_blank()
) +
ylab("Citations") +
geom_pointrange(aes(x=xdummy,y=estimate,ymin=estimate-(error*1.96),ymax=estimate+(error*1.96),
colour=jour.bin,shape=Open.Access)) +
geom_point(aes(x=c(101:108),y=estimate,shape=Open.Access)) +
scale_x_continuous(breaks = seq(1:4),labels=c("Low","Medium","High","Very high"),
expand=c(0,0)) +
coord_cartesian(xlim=c(0.5,4.5)) +
scale_shape_manual(values = c(1,19),labels=c("Open","Closed")) +
scale_colour_discrete(guide=F)
pf1
fit2a<-glmer(Cited.by ~ Open.Access*bin + (1|Year) + (1|Source.title),data=dat,family = poisson)
summary(fit2a)
y<-predict(fit1a)
g1<-ggplot(dat)
g1+geom_boxplot(aes(x=bin,y=y,colour=OA))
y<-predict(fit2a)
g1<-ggplot(dat)
g1+geom_boxplot(aes(x=bin,y=y,colour=OA))
library(ggplot2)
library(grid)
library(gridExtra)
library(plyr)
library(lme4)
library(visreg)
library(reshape)
## clean data and merge with journal metric data
rm(list=ls())
setwd("~/GitHub/open-climate-change/")
setwd('/Users/robins64/Documents/git_repos/open-climate-change')
## load data
load("./Data/scopus_OA_climate_clean.Rdata")  ## scopus data filtered by Jimmy - journals with > 200 papers in last 10 years
full.scop<-read.csv("./Data/ScopusOAData_20180214TT.csv",stringsAsFactors = F)
head(scop)
head(full.scop)
## choose filtered data or full data
dat<-scop
dat$Cited.by[which(is.na(dat$Cited.by))]<-0
#nrow(dat[which(dat$Cited.by==0),])
#dat<-dat[which(dat$Cited.by>0),]
jour.dat<-dat[,c("Source.title","X2016.CiteScore","X2016.SJR","X2016.SNIP","Journal.Open.Access")]
jour.dat<-jour.dat[-which(duplicated(jour.dat)),]
## plot raw data
p1<-ggplot(dat)
p1F<-p1 + geom_boxplot(aes(x=as.factor(Year), y=log(Cited.by+1), colour=Open.Access)) +
xlab("Year") + ylab("# citations (log +1)")
p1F<-p1 + geom_boxplot(aes(x=as.factor(Year), y=log(Cited.by+1), colour=Open.Access),
outlier.shape=NA) +
xlab("Year") + ylab("# citations (log +1)")
#pdf("./figures/exploratory/scopus/cite_byyear_boxplot_nooutliers.pdf")
p1F
dev.off()
sum.dat<-ddply(dat,.(Open.Access,Year),summarize,
CiteAve = mean(Cited.by,na.rm=T),
CiteVar = var(Cited.by,na.rm=T),
CiteN = length(Cited.by))
Jour.Var<-"X2016.SJR"     ## Use this
bins<-quantile(jour.dat[,Jour.Var],na.rm=T)  ##quantile bins
jour.dat$bin<-cut(jour.dat[,Jour.Var],breaks = bins,labels = LETTERS[1:(length(bins)-1)])
jour.dat$bin[which(is.na(jour.dat$bin))]<-"A"
dat$jour.bin<-cut(dat[,Jour.Var],breaks = bins,labels = LETTERS[1:(length(bins)-1)])
dat$jour.bin[which(is.na(dat$jour.bin))]<-"A"
sum.dat2<-ddply(dat,.(Open.Access,Year,jour.bin),summarize,
CiteAve = mean(Cited.by,na.rm=T),
CiteVar = var(Cited.by,na.rm=T),
CiteN = length(Cited.by))
sum.dat2a<-ddply(sum.dat2,.(jour.bin),summarize,
N = sum(CiteN))
sum.dat2a$PropN<-sum.dat2a$N/sum(sum.dat2a$N)
sum.dat3<-cast(sum.dat2[,1:4],Year+jour.bin ~ Open.Access)
names(sum.dat3)[4]<-"Open.Access"
sum.dat3$CiteAveRatio<-with(sum.dat3,Open.Access/Closed)
p1<-ggplot(dat)
p1F<-p1 + theme_classic() +
ggtitle(Jour.Var) +
xlab("Year") +
ylab("# citations (log + 1)") +
geom_boxplot(aes(x=as.factor(Year),y=log(Cited.by+1),colour=Open.Access),
outlier.shape=NA) +
facet_wrap(~jour.bin,nrow = 2,ncol = 2, scales="free")
p1F
sum.dat3
names(dat)
summary(dat$Cited.by)
names(dat)
sub.dat<-dat[,c("Source.title","Year","Cited.by","OA","Open.Access","jour.bin")]
mod.dat<-ddply(sub.dat,.(Year,Open.Access,OA,jour.bin),summarize,
MeanCite = mean(Cited.by,na.rm=T))
names(dat)
sub.dat<-dat[,c("Source.title","Year","Cited.by","OA","Open.Access","jour.bin")]
mod.dat<-ddply(sub.dat,.(Source.title,Year,Open.Access,OA,jour.bin),summarize,
MeanCite = mean(Cited.by,na.rm=T))
View(mod.dat)
116*10
mod.fit
mod.dat
head(mod.dat)
fit2a<-lmer(MeanCite ~ jour.bin*OA + (1|Year),data=mod.dat)
fit2a<-lmer(MeanCite ~ jour.bin*OA + (1|Year),data=mod.dat)
summary(fit2a)
?expand.grid
rm(list=ls())
setwd("~/GitHub/open-climate-change/")
setwd('/Users/robins64/Documents/git_repos/open-climate-change')
library(here); library(dplyr); library(tidyr); library(ggplot2); theme_set(theme_bw()); library(gridExtra); library(lme4)
load(file='Data/altmetric_OA_clean.Rdata')
names(alt)
means<-alt %>% select(Altmetric.Attention.Score, Journal, year, SJR,News.mentions, Blog.mentions, Policy.mentions, Twitter.mentions, OA) %>%
filter(!Journal == '') %>%
group_by(Journal, OA, year) %>%
summarise(attention = mean(Altmetric.Attention.Score),
news = mean(News.mentions),
blog=mean(Blog.mentions),
policy=mean(Policy.mentions),
twitter=mean(Twitter.mentions),
SJR = mean(SJR))
View(means)
rm(list=ls())
setwd("~/GitHub/open-climate-change/")
setwd('/Users/robins64/Documents/git_repos/open-climate-change')
se<-function(x) sd(x)/sqrt(length(x))
library(here); library(dplyr); library(tidyr); library(ggplot2); theme_set(theme_bw()); library(plotrix)
add_label <- function(xfrac, yfrac, label, pos = 4, ...){
u <- par("usr")
x <- u[1] + xfrac * (u[2] - u[1])
y <- u[4] - yfrac * (u[4] - u[3])
text(x, y, label, pos = pos, ...)
}
load(file='Data/altmetric_OA_clean.Rdata')
names(alt)
unique(alt$Journal[alt$SJRfac=='A']) ## n = 24
aggregate(Journal ~ OA, alt[alt$SJRfac=='A',], function(x)length(unique(x))) ## 12 open, 22 closed
unique(alt$Journal[alt$SJRfac=='B']) ## n = 29
aggregate(Journal ~ OA, alt[alt$SJRfac=='B',], function(x)length(unique(x))) ## 16 open, 24 closed
unique(alt$Journal[alt$SJRfac=='C']) ## n = 21
aggregate(Journal ~ OA, alt[alt$SJRfac=='C',], function(x)length(unique(x))) ## 14 open, 17 closed
unique(alt$Journal[alt$SJRfac=='D']) ## n = 23
aggregate(Journal ~ OA, alt[alt$SJRfac=='D',], function(x)length(unique(x))) ## 10 open, 20 closed
t<-alt[alt$Policy.mentions>0,]
ggplot(t, aes(year, Policy.mentions, col=OA))+ geom_point()
dim(t[t$OA=='TRUE',]) ## 112 OA policy mentions
ratio<-alt %>% mutate(OA = ifelse(OA == TRUE, 'Open', 'Closed')) %>%
group_by(SJRfac, OA, Journal, year) %>%
summarise(news = mean(News.mentions),
policy=mean(Policy.mentions),
twitter=mean(Twitter.mentions)) %>%
gather(source, mentions, -SJRfac, -OA, -Journal, -year)
library(here); library(dplyr); library(tidyr); library(ggplot2); theme_set(theme_bw()); library(plotrix)
install.packages("tidyr")
library(here); library(dplyr); library(tidyr); library(ggplot2); theme_set(theme_bw()); library(plotrix)
install.packages("plotrix")
library(here); library(dplyr); library(tidyr); library(ggplot2); theme_set(theme_bw()); library(plotrix)
add_label <- function(xfrac, yfrac, label, pos = 4, ...){
u <- par("usr")
x <- u[1] + xfrac * (u[2] - u[1])
y <- u[4] - yfrac * (u[4] - u[3])
text(x, y, label, pos = pos, ...)
}
load(file='Data/altmetric_OA_clean.Rdata')
names(alt)
unique(alt$Journal[alt$SJRfac=='A']) ## n = 24
aggregate(Journal ~ OA, alt[alt$SJRfac=='A',], function(x)length(unique(x))) ## 12 open, 22 closed
unique(alt$Journal[alt$SJRfac=='B']) ## n = 29
aggregate(Journal ~ OA, alt[alt$SJRfac=='B',], function(x)length(unique(x))) ## 16 open, 24 closed
unique(alt$Journal[alt$SJRfac=='C']) ## n = 21
aggregate(Journal ~ OA, alt[alt$SJRfac=='C',], function(x)length(unique(x))) ## 14 open, 17 closed
unique(alt$Journal[alt$SJRfac=='D']) ## n = 23
aggregate(Journal ~ OA, alt[alt$SJRfac=='D',], function(x)length(unique(x))) ## 10 open, 20 closed
t<-alt[alt$Policy.mentions>0,]
ggplot(t, aes(year, Policy.mentions, col=OA))+ geom_point()
dim(t[t$OA=='TRUE',]) ## 112 OA policy mentions
ratio<-alt %>% mutate(OA = ifelse(OA == TRUE, 'Open', 'Closed')) %>%
group_by(SJRfac, OA, Journal, year) %>%
summarise(news = mean(News.mentions),
policy=mean(Policy.mentions),
twitter=mean(Twitter.mentions)) %>%
gather(source, mentions, -SJRfac, -OA, -Journal, -year)
ratio$mentions[is.na(ratio$mentions)]<-0
library(lme4)
news<-glmer(mentions ~ OA * SJRfac + (1 | year) + (1 | Journal),family='poisson',
ratio[ratio$source=='news',])
summary(news)
hist(resid(news))
news.dat<-expand.grid(OA = unique(ratio$OA), SJRfac=unique(ratio$SJRfac), year = 2008, Journal='Ecology')
news.dat$p<-predict(news, newdat=news.dat, re.form=NA, type='response')
news.dat$source<-'news'
View(ratio)
ratio<-alt %>% mutate(OA = ifelse(OA == TRUE, 'Open', 'Closed')) %>%
group_by(SJRfac, OA, Journal, year) %>%
summarise(news = mean(News.mentions),
policy=mean(Policy.mentions),
twitter=mean(Twitter.mentions)) %>%
gather(source, mentions, -SJRfac, -OA, -Journal, -year)
View(ratio)
news<-lmer(mentions ~ OA * SJRfac + (1 | year) + (1 | Journal),#family='poisson',
ratio[ratio$source=='news',])
summary(news)
hist(resid(news))
names(dat)
sub.dat<-dat[,c("Source.title","Year","Cited.by","OA","Open.Access","jour.bin")]
library(ggplot2)
library(grid)
library(gridExtra)
library(plyr)
library(lme4)
library(visreg)
library(reshape)
## clean data and merge with journal metric data
rm(list=ls())
setwd("~/GitHub/open-climate-change/")
setwd('/Users/robins64/Documents/git_repos/open-climate-change')
## load data
load("./Data/scopus_OA_climate_clean.Rdata")  ## scopus data filtered by Jimmy - journals with > 200 papers in last 10 years
full.scop<-read.csv("./Data/ScopusOAData_20180214TT.csv",stringsAsFactors = F)
head(scop)
head(full.scop)
## choose filtered data or full data
dat<-scop
dat$Cited.by[which(is.na(dat$Cited.by))]<-0
#nrow(dat[which(dat$Cited.by==0),])
#dat<-dat[which(dat$Cited.by>0),]
jour.dat<-dat[,c("Source.title","X2016.CiteScore","X2016.SJR","X2016.SNIP","Journal.Open.Access")]
jour.dat<-jour.dat[-which(duplicated(jour.dat)),]
## plot raw data
p1<-ggplot(dat)
p1F<-p1 + geom_boxplot(aes(x=as.factor(Year), y=log(Cited.by+1), colour=Open.Access)) +
xlab("Year") + ylab("# citations (log +1)")
p1F<-p1 + geom_boxplot(aes(x=as.factor(Year), y=log(Cited.by+1), colour=Open.Access),
outlier.shape=NA) +
xlab("Year") + ylab("# citations (log +1)")
#pdf("./figures/exploratory/scopus/cite_byyear_boxplot_nooutliers.pdf")
p1F
dev.off()
####################################
#
# Analyze all data
## summarize all data
sum.dat<-ddply(dat,.(Open.Access,Year),summarize,
CiteAve = mean(Cited.by,na.rm=T),
CiteVar = var(Cited.by,na.rm=T),
CiteN = length(Cited.by))
## bin for journal rankings
#Jour.Var<-"X2016.CiteScore"  ## Choose metric: "X2016.CiteScore" or "X2016.SJR" or "X2016.SNIP"
Jour.Var<-"X2016.SJR"     ## Use this
#Jour.Var<-"X2016.SNIP"
bins<-quantile(jour.dat[,Jour.Var],na.rm=T)  ##quantile bins
## write out journal list with bins
jour.dat$bin<-cut(jour.dat[,Jour.Var],breaks = bins,labels = LETTERS[1:(length(bins)-1)])
jour.dat$bin[which(is.na(jour.dat$bin))]<-"A"
#write.csv(jour.dat,"./Data/BinJournallist_fromScopus.csv",row.names=F)
dat$jour.bin<-cut(dat[,Jour.Var],breaks = bins,labels = LETTERS[1:(length(bins)-1)])
dat$jour.bin[which(is.na(dat$jour.bin))]<-"A"
sum.dat2<-ddply(dat,.(Open.Access,Year,jour.bin),summarize,
CiteAve = mean(Cited.by,na.rm=T),
CiteVar = var(Cited.by,na.rm=T),
CiteN = length(Cited.by))
sum.dat2a<-ddply(sum.dat2,.(jour.bin),summarize,
N = sum(CiteN))
sum.dat2a$PropN<-sum.dat2a$N/sum(sum.dat2a$N)
sum.dat3<-cast(sum.dat2[,1:4],Year+jour.bin ~ Open.Access)
names(sum.dat3)[4]<-"Open.Access"
sum.dat3$CiteAveRatio<-with(sum.dat3,Open.Access/Closed)
names(dat)
sub.dat<-dat[,c("Source.title","Year","Cited.by","OA","Open.Access","jour.bin")]
mod.dat<-ddply(sub.dat,.(Source.title,Year,Open.Access,OA,jour.bin),summarize,
MeanCite = mean(Cited.by,na.rm=T))
fit5a<-lmer(MeanCite ~ jour.bin*OA + (1|Year),data=mod.dat)
summary(fit5a)
hist(resid(fit5a))
fit5b<-glmer(MeanCite ~ jour.bin*OA + (1|Year),data=mod.dat,family="poisson")
summary(fit5b)
hist(resid(fit5b))
summary(fit5b)
hist(resid(fit5b))
hist(resid(fit5a))
hist(resid(fit5b))
scop.dat<-expand.grid(OA = unique(mod.dat$OA), jour.bin=unique(mod.dat$jour.bin), year = 2008, Journal='Ecology')
scop.dat
news.dat$p<-predict(fit5b, newdat=scop.dat, re.form=NA, type='response')
scop.dat$p<-predict(fit5b, newdat=scop.dat, re.form=NA, type='response')
scop.dat
ggplot(scop.dat,aes(x=jour.bin,y=p,shape=OA))
str(scop.dat)
dev.ofF(0)
dev.off()
ggplot(scop.dat,aes(x=jour.bin,y=p,shape=OA))
ggplot(scop.dat,aes(x=jour.bin,y=p,shape=OA)) + geom_point()
mod.dat
head(mod.dat)
mod.dat2<-ddply(mod.dat,.(Open.Access,OA,jour.bin),summarize,
MeanCite = mean(MeanCite,na.rm=T))
mod.dat2<-ddply(mod.dat,.(Open.Access,OA,jour.bin),summarize,
MeanCite = mean(MeanCite,na.rm=T))
ggplot(mod.dat2,aes(x=jour.bin,y=MeanCite,shape=OA)) + geom_point()
hist(resid(fit5b))
hist(resid(fit5a))
hist(resid(fit5b))
quartz()
hist(resid(fit5b))
quartz()
ggplot(scop.dat,aes(x=jour.bin,y=p,shape=OA)) + geom_point()
library(ggplot2)
library(grid)
library(gridExtra)
library(plyr)
library(lme4)
library(visreg)
library(reshape)
## clean data and merge with journal metric data
rm(list=ls())
setwd("~/GitHub/open-climate-change/")
setwd('/Users/robins64/Documents/git_repos/open-climate-change')
load("./Data/scopus_OA_climate_clean.Rdata")  ## scopus data filtered by Jimmy - journals with > 200 papers in last 10 years
full.scop<-read.csv("./Data/ScopusOAData_20180214TT.csv",stringsAsFactors = F)
head(scop)
head(full.scop)
dat<-scop
dat$Cited.by[which(is.na(dat$Cited.by))]<-0
jour.dat<-dat[,c("Source.title","X2016.CiteScore","X2016.SJR","X2016.SNIP","Journal.Open.Access")]
jour.dat<-jour.dat[-which(duplicated(jour.dat)),]
Jour.Var<-"X2016.SJR"     ## Use this
bins<-quantile(jour.dat[,Jour.Var],na.rm=T)  ##quantile bins
jour.dat$bin<-cut(jour.dat[,Jour.Var],breaks = bins,labels = LETTERS[1:(length(bins)-1)])
jour.dat$bin[which(is.na(jour.dat$bin))]<-"A"
dat$jour.bin<-cut(dat[,Jour.Var],breaks = bins,labels = LETTERS[1:(length(bins)-1)])
dat$jour.bin[which(is.na(dat$jour.bin))]<-"A"
names(dat)
sub.dat<-dat[,c("Source.title","Year","Cited.by","OA","Open.Access","jour.bin")]
mod.dat<-ddply(sub.dat,.(Source.title,Year,Open.Access,OA,jour.bin),summarize,
MeanCite = mean(Cited.by,na.rm=T))
fit5a<-lmer(MeanCite ~ jour.bin*OA + (1|Year),data=mod.dat)
summary(fit5a)
hist(resid(fit5a))
fit5b<-glmer(MeanCite ~ jour.bin*OA + (1|Year),data=mod.dat,family="poisson")
quartz()
hist(resid(fit5b))
save(fit5b, file='./Data/scopus_glmerfit.Rdata')
load("./Data/scopus_glmerfit.Rdata")
scop.dat<-expand.grid(OA = unique(mod.dat$OA), jour.bin=unique(mod.dat$jour.bin), year = 2008, Journal='Ecology')
scop.dat$p<-predict(fit5b, newdat=scop.dat, re.form=NA, type='response')
quartz()
ggplot(scop.dat,aes(x=jour.bin,y=p,shape=OA)) + geom_point()
